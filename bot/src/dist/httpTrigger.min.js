"use strict";var notificationTemplate=require("./adaptiveCards/notification-default.json"),_require=require("@microsoft/adaptivecards-tools"),AdaptiveCards=_require.AdaptiveCards,_require2=require("./internal/initialize"),bot=_require2.bot,_require3=require("@microsoft/teamsfx"),AppCredential=_require3.AppCredential,createMicrosoftGraphClientWithCredential=_require3.createMicrosoftGraphClientWithCredential,_require4=require("@microsoft/microsoft-graph-client"),ResponseType=_require4.ResponseType;module.exports=function(t){var r,n,a,i,s,o,c,p,d,u,l,m,f,h;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(r=!0),a=void 0,e.prev=3,e.next=6,regeneratorRuntime.awrap(bot.notification.installations());case 6:e.t0=Symbol.iterator,i=e.sent[e.t0]();case 8:if(r=(s=i.next()).done){e.next=35;break}return o=s.value,c={authorityHost:process.env.M365_AUTHORITY_HOST,clientId:process.env.M365_CLIENT_ID,tenantId:process.env.M365_TENANT_ID,clientSecret:process.env.M365_CLIENT_SECRET},p=new AppCredential(c),d=createMicrosoftGraphClientWithCredential(p),u={"template@odata.bind":"https://graph.microsoft.com/v1.0/teamsTemplates('"+process.env.TEAMS_TEMPLATE_ID+"')",displayName:"My Incident 327-1",description:"My Incident 327-1 description",members:[{"@odata.type":"#microsoft.graph.aadUserConversationMember",roles:["owner"],"user@odata.bind":"https://graph.microsoft.com/v1.0/users/"+process.env.MOD_ID}]},e.next=16,regeneratorRuntime.awrap(d.api("/teams").responseType(ResponseType.RAW).post(u));case 16:l=e.sent,console.log(l.headers.get("client-request-id")),m=l.headers.get("Location"),f="inProgress";case 20:if("succeeded"!=f)return e.next=23,regeneratorRuntime.awrap(d.api(m).get());e.next=29;break;case 23:return h=e.sent,f=h.status,e.next=27,regeneratorRuntime.awrap(new Promise(function(e){return setTimeout(e,5e3)}));case 27:e.next=20;break;case 29:return console.log("Team created successfully!"),e.next=32,regeneratorRuntime.awrap(o.sendAdaptiveCard(AdaptiveCards.declare(notificationTemplate).render({title:"New Incident Occurred!",appName:"Disaster Tech",description:"Welcome to the new incident team. Here is the Incident Action Plan:  ".concat(o.type),notificationUrl:"https://m365x501367.sharepoint.com/sites/MyIncident4/Shared%20Documents/General/469308021927-5522126379-ticket.pdf"})));case 32:r=!0,e.next=8;break;case 35:e.next=41;break;case 37:e.prev=37,e.t1=e.catch(3),n=!0,a=e.t1;case 41:e.prev=41,e.prev=42,r||null==i.return||i.return();case 44:if(e.prev=44,n)throw a;e.next=47;break;case 47:return e.finish(44);case 48:return e.finish(41);case 49:t.res={};case 50:case"end":return e.stop()}},null,null,[[3,37,41,49],[42,,44,48]])};
//# sourceMappingURL=httpTrigger.min.js.map
